# 计算机网络面试题集

> 计算机网络基础知识与高频面试题

## A. 面试宝典

### 基础题

#### 1. OSI 七层模型与 TCP/IP 四层模型

```
┌─────────────────────────────────────────────────────────────┐
│                    网络分层模型对比                          │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  OSI 七层模型          TCP/IP 四层模型        协议示例       │
│  ──────────────────────────────────────────────────────────│
│  应用层                                       HTTP, FTP     │
│  表示层                 应用层                SMTP, DNS     │
│  会话层                                       SSH, Telnet   │
│  ──────────────────────────────────────────────────────────│
│  传输层                 传输层                TCP, UDP      │
│  ──────────────────────────────────────────────────────────│
│  网络层                 网络层                IP, ICMP, ARP │
│  ──────────────────────────────────────────────────────────│
│  数据链路层                                   以太网, PPP   │
│  物理层                 网络接口层            物理介质      │
│                                                              │
│  数据封装过程：                                              │
│  应用层：数据                                               │
│  传输层：数据 + TCP/UDP头 = 段(Segment)                    │
│  网络层：段 + IP头 = 包(Packet)                            │
│  数据链路层：包 + MAC头 + 尾 = 帧(Frame)                   │
│  物理层：比特流                                             │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

#### 2. TCP 三次握手与四次挥手

```
┌─────────────────────────────────────────────────────────────┐
│                    TCP 三次握手                              │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  客户端                              服务端                  │
│  CLOSED                              LISTEN                 │
│    │                                    │                   │
│    │──────── SYN (seq=x) ──────────▶│                      │
│    │          第一次握手                │                   │
│  SYN_SENT                              │                   │
│    │                                    │                   │
│    │◀────── SYN+ACK (seq=y, ack=x+1) ──│                   │
│    │          第二次握手                │                   │
│    │                              SYN_RCVD                  │
│    │                                    │                   │
│    │──────── ACK (ack=y+1) ────────▶│                      │
│    │          第三次握手                │                   │
│  ESTABLISHED                     ESTABLISHED               │
│                                                              │
│  为什么是三次？                                              │
│  1. 确认双方的发送和接收能力                                 │
│  2. 防止已失效的连接请求到达服务器                           │
│                                                              │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                    TCP 四次挥手                              │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  客户端                              服务端                  │
│  ESTABLISHED                       ESTABLISHED              │
│    │                                    │                   │
│    │──────── FIN (seq=u) ──────────▶│                      │
│    │          第一次挥手                │                   │
│  FIN_WAIT_1                            │                   │
│    │                                    │                   │
│    │◀────── ACK (ack=u+1) ─────────────│                   │
│    │          第二次挥手                │                   │
│  FIN_WAIT_2                        CLOSE_WAIT              │
│    │                                    │                   │
│    │◀────── FIN (seq=v) ───────────────│                   │
│    │          第三次挥手                │                   │
│    │                               LAST_ACK                │
│    │                                    │                   │
│    │──────── ACK (ack=v+1) ────────▶│                      │
│    │          第四次挥手                │                   │
│  TIME_WAIT                          CLOSED                 │
│    │                                                        │
│    │ (等待 2MSL)                                           │
│    │                                                        │
│  CLOSED                                                     │
│                                                              │
│  为什么是四次？                                              │
│  1. TCP 是全双工，每个方向都需要单独关闭                     │
│  2. 服务端可能还有数据要发送                                 │
│                                                              │
│  TIME_WAIT 作用：                                           │
│  1. 确保最后的 ACK 能到达服务端                              │
│  2. 让旧连接的数据包在网络中消失                             │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

#### 3. TCP vs UDP

```
┌─────────────────────────────────────────────────────────────┐
│                    TCP vs UDP                                │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  特性              TCP                  UDP                  │
│  ──────────────────────────────────────────────────────────│
│  连接              面向连接              无连接              │
│  可靠性            可靠传输              不可靠传输          │
│  有序性            保证顺序              不保证顺序          │
│  流量控制          有                    无                  │
│  拥塞控制          有                    无                  │
│  传输速度          较慢                  较快                │
│  头部开销          20-60字节             8字节               │
│  连接方式          点对点                支持广播/多播       │
│                                                              │
│  TCP 应用：HTTP, FTP, SMTP, SSH                             │
│  UDP 应用：DNS, DHCP, 视频流, 游戏                          │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

**TCP 可靠传输机制：**
```
1. 序列号和确认号
   - 每个字节都有序列号
   - 接收方返回 ACK 确认

2. 超时重传
   - 未收到 ACK 则重传
   - RTO (Retransmission Timeout) 动态计算

3. 滑动窗口
   - 流量控制：接收方通告窗口大小
   - 发送方不能发送超过窗口大小的数据

4. 拥塞控制
   - 慢启动：指数增长
   - 拥塞避免：线性增长
   - 快重传：收到3个重复ACK立即重传
   - 快恢复：门限减半，继续发送
```

---

#### 4. HTTP 协议

```
┌─────────────────────────────────────────────────────────────┐
│                    HTTP 版本对比                             │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  HTTP/1.0:                                                  │
│  - 每次请求都需要建立新连接                                  │
│  - 无 Host 头（不支持虚拟主机）                              │
│                                                              │
│  HTTP/1.1:                                                  │
│  - 持久连接（Keep-Alive）                                   │
│  - 管道化（Pipelining）                                     │
│  - 分块传输编码                                             │
│  - 新增缓存控制                                             │
│                                                              │
│  HTTP/2:                                                    │
│  - 二进制分帧                                               │
│  - 多路复用（一个连接多个请求）                             │
│  - 头部压缩（HPACK）                                        │
│  - 服务器推送                                               │
│  - 请求优先级                                               │
│                                                              │
│  HTTP/3:                                                    │
│  - 基于 QUIC（UDP）                                         │
│  - 0-RTT 连接                                               │
│  - 改进的拥塞控制                                           │
│  - 连接迁移                                                 │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

**HTTP 状态码：**
```
1xx 信息性：
    100 Continue

2xx 成功：
    200 OK
    201 Created
    204 No Content

3xx 重定向：
    301 Moved Permanently（永久重定向）
    302 Found（临时重定向）
    304 Not Modified（缓存有效）
    307 Temporary Redirect（保持方法）

4xx 客户端错误：
    400 Bad Request
    401 Unauthorized（未认证）
    403 Forbidden（无权限）
    404 Not Found
    405 Method Not Allowed
    429 Too Many Requests

5xx 服务器错误：
    500 Internal Server Error
    502 Bad Gateway
    503 Service Unavailable
    504 Gateway Timeout
```

**HTTP 请求方法：**
```
GET     获取资源（幂等）
POST    创建资源
PUT     更新资源（完整替换，幂等）
PATCH   部分更新
DELETE  删除资源（幂等）
HEAD    获取响应头（不返回body）
OPTIONS 获取支持的方法
```

---

#### 5. HTTPS 与 TLS

```
┌─────────────────────────────────────────────────────────────┐
│                    TLS 握手过程                              │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  客户端                              服务端                  │
│    │                                    │                   │
│    │─── ClientHello ───────────────▶│                      │
│    │    (支持的加密套件、随机数)        │                   │
│    │                                    │                   │
│    │◀── ServerHello ───────────────────│                   │
│    │    (选择的加密套件、随机数)        │                   │
│    │◀── Certificate ───────────────────│                   │
│    │    (服务器证书)                    │                   │
│    │◀── ServerKeyExchange ─────────────│                   │
│    │◀── ServerHelloDone ───────────────│                   │
│    │                                    │                   │
│    │─── ClientKeyExchange ─────────▶│                      │
│    │    (预主密钥，用公钥加密)          │                   │
│    │─── ChangeCipherSpec ──────────▶│                      │
│    │─── Finished ──────────────────▶│                      │
│    │                                    │                   │
│    │◀── ChangeCipherSpec ──────────────│                   │
│    │◀── Finished ──────────────────────│                   │
│    │                                    │                   │
│    │◀═══════ 加密通信 ═══════════════▶│                   │
│                                                              │
│  密钥生成：                                                  │
│  预主密钥 + 客户端随机数 + 服务端随机数 = 主密钥             │
│  主密钥派生出：会话密钥、MAC密钥、IV                         │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

**HTTPS 特点：**
```
1. 加密：对称加密通信内容
2. 认证：服务器证书验证身份
3. 完整性：MAC 防止篡改

HTTP vs HTTPS:
- HTTP 明文传输，HTTPS 加密传输
- HTTP 80端口，HTTPS 443端口
- HTTPS 需要 SSL/TLS 证书
- HTTPS 更安全，但有轻微性能开销
```

---

### 进阶题

#### 6. DNS 解析过程

```
┌─────────────────────────────────────────────────────────────┐
│                    DNS 解析流程                              │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  浏览器输入 www.example.com                                  │
│    │                                                        │
│    ▼                                                        │
│  1. 浏览器缓存                                              │
│    │ 未命中                                                 │
│    ▼                                                        │
│  2. 操作系统缓存（hosts文件）                               │
│    │ 未命中                                                 │
│    ▼                                                        │
│  3. 本地 DNS 服务器（递归查询）                             │
│    │ 未命中                                                 │
│    ▼                                                        │
│  4. 根 DNS 服务器                                           │
│    │ 返回 .com 顶级域服务器地址                             │
│    ▼                                                        │
│  5. 顶级域 DNS 服务器（.com）                               │
│    │ 返回 example.com 权威服务器地址                        │
│    ▼                                                        │
│  6. 权威 DNS 服务器                                         │
│    │ 返回 www.example.com 的 IP                             │
│    ▼                                                        │
│  7. 本地 DNS 服务器缓存并返回                               │
│    │                                                        │
│    ▼                                                        │
│  8. 浏览器缓存并发起 HTTP 请求                              │
│                                                              │
│  DNS 记录类型：                                              │
│  A     域名 → IPv4                                          │
│  AAAA  域名 → IPv6                                          │
│  CNAME 域名 → 另一个域名                                    │
│  MX    邮件服务器                                           │
│  NS    域名服务器                                           │
│  TXT   文本记录                                             │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

#### 7. 从 URL 到页面显示

```
1. URL 解析
   - 协议、域名、端口、路径、查询参数

2. DNS 解析
   - 浏览器缓存 → OS缓存 → 本地DNS → 根DNS → 权威DNS

3. TCP 连接
   - 三次握手建立连接

4. TLS 握手（HTTPS）
   - 证书验证、密钥交换

5. 发送 HTTP 请求
   - 请求行、请求头、请求体

6. 服务器处理
   - 路由、业务逻辑、数据库查询

7. 返回 HTTP 响应
   - 状态码、响应头、响应体

8. 浏览器渲染
   - HTML → DOM树
   - CSS → CSSOM树
   - DOM + CSSOM → 渲染树
   - 布局（Layout）
   - 绘制（Paint）
   - 合成（Composite）

9. TCP 断开（四次挥手）
```

---

#### 8. WebSocket

```
┌─────────────────────────────────────────────────────────────┐
│                    WebSocket 特点                            │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  HTTP vs WebSocket:                                         │
│  ──────────────────────────────────────────────────────────│
│  HTTP:                                                      │
│  - 请求-响应模式                                            │
│  - 单向通信（客户端发起）                                   │
│  - 每次请求需要重新建立连接（HTTP/1.0）                     │
│                                                              │
│  WebSocket:                                                 │
│  - 全双工通信                                               │
│  - 服务器可主动推送                                         │
│  - 持久连接，低开销                                         │
│                                                              │
│  握手过程（基于 HTTP 升级）：                               │
│                                                              │
│  请求：                                                     │
│  GET /chat HTTP/1.1                                        │
│  Host: server.example.com                                  │
│  Upgrade: websocket                                        │
│  Connection: Upgrade                                       │
│  Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==              │
│  Sec-WebSocket-Version: 13                                 │
│                                                              │
│  响应：                                                     │
│  HTTP/1.1 101 Switching Protocols                          │
│  Upgrade: websocket                                        │
│  Connection: Upgrade                                       │
│  Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=       │
│                                                              │
│  应用场景：实时聊天、股票行情、在线游戏、协同编辑           │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

#### 9. CDN 原理

```
┌─────────────────────────────────────────────────────────────┐
│                    CDN 工作原理                              │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  用户请求 www.example.com                                    │
│    │                                                        │
│    ▼                                                        │
│  DNS 解析返回 CDN 节点 IP                                   │
│  (CNAME → CDN DNS → 最近节点)                               │
│    │                                                        │
│    ▼                                                        │
│  CDN 边缘节点                                               │
│    │                                                        │
│    ├── 缓存命中 → 直接返回                                  │
│    │                                                        │
│    └── 缓存未命中                                           │
│          │                                                  │
│          ▼                                                  │
│        回源到中心节点或源站                                  │
│          │                                                  │
│          ▼                                                  │
│        缓存内容并返回                                       │
│                                                              │
│  CDN 优势：                                                 │
│  1. 加速访问（就近访问）                                    │
│  2. 降低源站负载                                            │
│  3. 提高可用性（多节点）                                    │
│  4. 防御 DDoS                                               │
│                                                              │
│  适合 CDN 的内容：                                          │
│  - 静态资源（CSS、JS、图片）                                │
│  - 大文件下载                                               │
│  - 视频流媒体                                               │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

#### 10. 网络安全

```
常见攻击类型：

1. DDoS 攻击
   - SYN Flood：发送大量 SYN 包耗尽连接
   - UDP Flood：发送大量 UDP 包耗尽带宽
   - HTTP Flood：大量 HTTP 请求

2. 中间人攻击（MITM）
   - ARP 欺骗：伪造 MAC 地址
   - DNS 劫持：篡改 DNS 响应
   - SSL 剥离：降级 HTTPS 为 HTTP

3. DNS 劫持
   - 篡改 DNS 响应
   - 重定向到恶意网站

防御措施：
- 使用 HTTPS
- DNSSEC 验证
- 防火墙配置
- 流量清洗
- CDN 防护
```

---

### 避坑指南

| 问题 | 说明 |
|------|------|
| TCP 三次握手变两次 | 无法防止历史连接 |
| TIME_WAIT 过多 | 可调整内核参数或使用连接池 |
| DNS 缓存过长 | 可能导致切换延迟 |
| HTTPS 证书过期 | 需要监控和自动续期 |

---

## B. 实战文档

### 常用网络命令

```bash
# DNS 查询
nslookup example.com
dig example.com
host example.com

# 网络连通性
ping example.com
traceroute example.com
mtr example.com

# TCP 连接
telnet host port
nc -zv host port

# 抓包
tcpdump -i eth0 port 80
tcpdump -w file.pcap

# 网络统计
netstat -tlnp
ss -tlnp
lsof -i :80

# HTTP 请求
curl -v https://example.com
curl -X POST -d "data" url
curl -H "Header: value" url

# 查看路由
ip route
route -n
```

### 网络排查流程

```
1. 确认网络连通性
   ping target_ip

2. 检查 DNS 解析
   nslookup domain

3. 检查端口连通性
   telnet host port

4. 检查路由
   traceroute target

5. 抓包分析
   tcpdump -i eth0 host target

6. 查看连接状态
   netstat -an | grep ESTABLISHED
```
